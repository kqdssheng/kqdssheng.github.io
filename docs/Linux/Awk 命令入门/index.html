<!doctype html>
<html lang="zh" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-Linux/Awk 命令入门" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.7.0">
<title data-rh="true">Awk 命令入门 | 扛枪的书生</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://kqdssheng.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://kqdssheng.github.io/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://kqdssheng.github.io/docs/Linux/Awk 命令入门"><meta data-rh="true" property="og:locale" content="zh"><meta data-rh="true" name="docusaurus_locale" content="zh"><meta data-rh="true" name="docsearch:language" content="zh"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Awk 命令入门 | 扛枪的书生"><meta data-rh="true" name="description" content="本文取自 Linux 中国，本人仅是对文章做一个防丢备份。"><meta data-rh="true" property="og:description" content="本文取自 Linux 中国，本人仅是对文章做一个防丢备份。"><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://kqdssheng.github.io/docs/Linux/Awk 命令入门"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/docs/Linux/Awk 命令入门" hreflang="zh"><link data-rh="true" rel="alternate" href="https://kqdssheng.github.io/docs/Linux/Awk 命令入门" hreflang="x-default"><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="扛枪的书生 RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="扛枪的书生 Atom Feed"><link rel="stylesheet" href="/assets/css/styles.b7abb307.css">
<script src="/assets/js/runtime~main.57146e47.js" defer="defer"></script>
<script src="/assets/js/main.e2b2a979.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();t(null!==e?e:"light")}(),function(){try{const n=new URLSearchParams(window.location.search).entries();for(var[t,e]of n)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="跳到主要内容"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">跳到主要内容</a></div><nav aria-label="主导航" class="navbar navbar--fixed-top navbarHideable_m1mJ navbar--primary"><div class="navbar__inner"><div class="navbar__items"><button aria-label="切换导航栏" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/category/️渗透">文章</a><a class="navbar__item navbar__link" href="/blog">说说</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">其它</a><ul class="dropdown__menu"><li><a href="https://www.douban.com/doulist/154252035/" target="_blank" rel="noopener noreferrer" class="dropdown__link">豆瓣<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.zhihu.com/people/KqdsshenG" target="_blank" rel="noopener noreferrer" class="dropdown__link">知乎<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://www.cnblogs.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">博客园<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://github.com/kqdssheng" target="_blank" rel="noopener noreferrer" class="dropdown__link">GitHub<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="切换浅色/暗黑模式（当前为浅色模式）" aria-label="切换浅色/暗黑模式（当前为浅色模式）" aria-live="polite" aria-pressed="false"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"><div class="navbar__search searchBarContainer_NW3z" dir="ltr"><input placeholder="搜索" aria-label="Search" class="navbar__search-input searchInput_YFbd" value=""><div class="loadingRing_RJI3 searchBarLoadingRing_YnHq"><div></div><div></div><div></div><div></div></div></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd sidebarWithHideableNavbar_wUlq"><a tabindex="-1" class="sidebarLogo_isFc" href="/"><img src="/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="kqdssheng" class="themedComponent_mlkZ themedComponent--dark_xIcU"></a><nav aria-label="文档侧边栏" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/️渗透">🕵️渗透</a><button aria-label="展开侧边栏分类 &#x27;🕵️渗透&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/category/linux">🐧Linux</a><button aria-label="折叠侧边栏分类 &#x27;🐧Linux&#x27;" aria-expanded="true" type="button" class="clean-btn menu__caret"></button></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Linux/Sed 命令完全指南">Sed 命令完全指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/Linux/Awk 命令入门">Awk 命令入门</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Linux/Socat 命令总结">Socat 命令总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Linux/Tcpdump 使用指南">Tcpdump 使用指南</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Linux/OpenSSL 命令总结">OpenSSL 命令总结</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Linux/Linux 开机引导和启动过程详解">Linux 开机引导和启动过程详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Linux/Linux 特权 SUID_SGID 的详解">Linux 特权 SUID_SGID 的详解</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/Linux/基于 Linux 的三种防火墙（IPtables、Firewall、UFW）">基于 Linux 的三种防火墙（IPtables、Firewall、UFW）</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/windows">💻Windows</a><button aria-label="展开侧边栏分类 &#x27;💻Windows&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/杂项-1">📦杂项</a><button aria-label="展开侧边栏分类 &#x27;📦杂项&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/category/gpt-问答">🤖GPT 问答</a><button aria-label="展开侧边栏分类 &#x27;🤖GPT 问答&#x27;" aria-expanded="false" type="button" class="clean-btn menu__caret"></button></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/">🛠️软件百宝箱</a></li></ul></nav><button type="button" title="收起侧边栏" aria-label="收起侧边栏" class="button button--secondary button--outline collapseSidebarButton_PEFL"><svg width="20" height="20" aria-hidden="true" class="collapseSidebarButtonIcon_kv0_"><g fill="#7a7a7a"><path d="M9.992 10.023c0 .2-.062.399-.172.547l-4.996 7.492a.982.982 0 01-.828.454H1c-.55 0-1-.453-1-1 0-.2.059-.403.168-.551l4.629-6.942L.168 3.078A.939.939 0 010 2.528c0-.548.45-.997 1-.997h2.996c.352 0 .649.18.828.45L9.82 9.472c.11.148.172.347.172.55zm0 0"></path><path d="M19.98 10.023c0 .2-.058.399-.168.547l-4.996 7.492a.987.987 0 01-.828.454h-3c-.547 0-.996-.453-.996-1 0-.2.059-.403.168-.551l4.625-6.942-4.625-6.945a.939.939 0 01-.168-.55 1 1 0 01.996-.997h3c.348 0 .649.18.828.45l4.996 7.492c.11.148.168.347.168.55zm0 0"></path></g></svg></button></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><a aria-label="主页面" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item"><a class="breadcrumbs__link" itemprop="item" href="/docs/category/linux"><span itemprop="name">🐧Linux</span></a><meta itemprop="position" content="1"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Awk 命令入门</span><meta itemprop="position" content="2"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Awk 命令入门</h1></header><blockquote>
<p>本文取自 <a href="https://linux.net.cn/article-4857-1.html" target="_blank" rel="noopener noreferrer">Linux 中国</a>，本人仅是对文章做一个防丢备份。</p>
</blockquote>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="1什么是-awk"><strong>1、什么是 Awk</strong><a href="#1什么是-awk" class="hash-link" aria-label="1什么是-awk的直接链接" title="1什么是-awk的直接链接">​</a></h2>
<p>Awk 是一种小巧的编程语言及命令行工具。（其名称得自于它的创始人 Alfred Aho、Peter Weinberger 和 Brian Kernighan 姓氏的首个字母）。它非常适合服务器上的日志处理，主要是因为 Awk 可以对文件进行操作，通常以可读文本构建行。</p>
<p><img decoding="async" loading="lazy" src="/assets/images/205716uph3b7dlvzgdpykc-5bf02e9b903eb0a267da3f118ad9aa9a.jpg" width="700" height="680" class="img_ev3q"></p>
<p>我说它适用于服务器是因为日志文件，转储文件（dump files），或者任意文本格式的服务器终止转储到磁盘都会变得很大，并且在每个服务器你都会拥有大量的这类文件。如果你经历过这样的情境——在没有像<a href="http://www.splunk.com/" target="_blank" rel="noopener noreferrer">Splunk</a><a href="http://www.splunk.com/" target="_blank" rel="noopener noreferrer">1</a>或者其他等价的工具情况下不得不在50个不同的服务器里分析几G的文件，你会觉得去获取和下载所有的这些文件并分析他们是一件很糟糕的事。</p>
<p>我亲身经历过这种情境。当一些 Erlang 节点将要死掉并留下一个 700MB 到 4GB 的<a href="http://www.erlang.org/doc/apps/erts/crash_dump.html" target="_blank" rel="noopener noreferrer">崩溃转储文件（crash dump）</a><a href="http://www.erlang.org/doc/apps/erts/crash_dump.html" target="_blank" rel="noopener noreferrer">2</a>时，或者当我需要在一个小的个人服务器（叫做 VPS）上快速浏览日志，查找一个常规模式时。</p>
<p>在任何情况下，Awk都不仅仅只是用来查找数据的（否则，grep 或者 ack 已经足够使用了）——它同样使你能够处理数据并转换数据。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="2代码结构"><strong>2、代码结构</strong><a href="#2代码结构" class="hash-link" aria-label="2代码结构的直接链接" title="2代码结构的直接链接">​</a></h2>
<p>Awk 脚本的代码结构很简单，就是一系列的模式（pattern）和行为（action）：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pattern1 { ACTIONS; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pattern2 { ACTIONS; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pattern3 { ACTIONS; }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># comment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Pattern4 { ACTIONS; }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>扫描文档的每一行时都必须与每一个模式进行匹配比较，而且一次只匹配一个模式。那么，如果我给出一个包含以下内容的文件：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">this is line 1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">this is line 2</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>this is line 1 这行就会与 Pattern1 进行匹配。如果匹配成功，就会执行 ACTIONS。然后 this is line 1 会和 Pattern2 进行匹配。如果匹配失败，它就会跳到 Pattern3 进行匹配，以此类推。</p>
<p>一旦所有的模式都匹配过了，this is line 2 就会以同样的步骤进行匹配。其他的行也一样，直到读取完整个文件。</p>
<p>简而言之，这就是 Awk 的运行模式</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="3数据类型"><strong>3、数据类型</strong><a href="#3数据类型" class="hash-link" aria-label="3数据类型的直接链接" title="3数据类型的直接链接">​</a></h2>
<p>Awk 仅有两个主要的数据类型：字符串和数字。即便如此，Awk 的字符串和数字还可以相互转换。字符串能够被解释为数字并把它的值转换为数字值。如果字符串不包含数字，它就被转换为 0。</p>
<p>它们都可以在你代码里的 ACTIONS 部分使用 = 操作符给变量赋值。我们可以在任意时刻、任意地方声明和使用变量，也可以使用未初始化的变量，此时他们的默认值是空字符串：&quot;&quot;。</p>
<p>最后，Awk 有数组类型，并且它们是动态的一维关联数组。它们的语法是这样的：var[key] = value 。Awk 可以<a href="http://www.staff.science.uu.nl/~oostr102/docs/nawk/nawk_87.html#SEC90" target="_blank" rel="noopener noreferrer">模拟多维数组</a><a href="http://www.staff.science.uu.nl/~oostr102/docs/nawk/nawk_87.html#SEC90" target="_blank" rel="noopener noreferrer">3</a>，但无论怎样，这是一个大的技巧（big hack）。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="4模式"><strong>4、模式</strong><a href="#4模式" class="hash-link" aria-label="4模式的直接链接" title="4模式的直接链接">​</a></h2>
<p>可以使用的模式分为三大类：正则表达式、布尔表达式和特殊模式。</p>
<p>正则表达式和布尔表达式</p>
<p>你使用的 Awk 正则表达式比较轻量。它们不是 Awk 下的 PCRE（但是 gawk 可以支持该库——这依赖于具体的实现！请使用 <code>awk –version</code>查看），然而，对于大部分的使用需求已经足够了：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">/admin/ { ... } # any line that contains &#x27;admin&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/^admin/ { ... } # lines that begin with &#x27;admin&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/admin$/ { ... } # lines that end with &#x27;admin&#x27;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/^[0-9.]+ / { ... } # lines beginning with series of numbers and periods</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/(POST|PUT|DELETE)/ # lines that contain specific HTTP verbs</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>注意，模式不能<a href="http://www.regular-expressions.info/named.html" target="_blank" rel="noopener noreferrer">捕获</a><a href="http://www.regular-expressions.info/named.html" target="_blank" rel="noopener noreferrer">4</a>特定的组（groups）使它们在代码的 ACTIONS 部分执行。模式是专门匹配内容的。</p>
<p>布尔表达式与 PHP 或者 Javascript 中的布尔表达式类似。特别的是，在 awk 中可以使用&amp;&amp;（“与”）、||（“或”）、!（“非”）操作符。你几乎可以在所有类 C语言中找到它们的踪迹。它们可以对常规数据进行操作。</p>
<p>与 PHP 和 Javascript 更相似的特性是比较操作符。== 操作符会进行模糊匹配（fuzzy matching），因此 &quot;23&quot; 字符串等于 23，&quot;23&quot; == 23 表达式返回 true。!= 操作符同样在 awk 里使用，并且别忘了其他常见的操作符：<code>&gt;，&lt;，&gt;=，和&lt;=</code>。</p>
<p>你同样可以混合使用它们：布尔表达式可以和常规表达式一起使用。 <code>/admin/ || debug == true</code> 这种用法是合法的，并且在遇到包含 &quot;admin&quot; 单词的行或者 debug 变量等于 true 时该表达式就会匹配成功。</p>
<p>注意，如果你有一个特定的字符串或者变量要与正则表达式进行匹配，~ 和!~ 就是你想要的操作符。 这样使用它们：<code>string ~ /regex/</code> 和 <code>string !~ /regex/</code>。</p>
<p>同样要注意的是，所有的模式都只是可选的。一个包含以下内容的 Awk 脚本：</p>
<p><code>{ ACTIONS }</code></p>
<p>对输入的每一行都将会简单地执行 ACTIONS。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="5特殊的模式"><strong>5、特殊的模式</strong><a href="#5特殊的模式" class="hash-link" aria-label="5特殊的模式的直接链接" title="5特殊的模式的直接链接">​</a></h2>
<p>在 Awk 里有一些特殊的模式，但不是很多。</p>
<p>第一个是 BEGIN，它仅在所有的行都输入到文件之前进行匹配。这是你可以初始化你的脚本变量和所有种类的状态的主要地方。</p>
<p>另外一个就是 END。就像你可能已经猜到的，它会在所有的输入都被处理完后进行匹配。这使你可以在退出前进行清除工作和一些最后的输出。</p>
<p>最后一类模式，要把它进行归类有点困难。它处于变量和特殊值之间，我们通常称它们为域（Field）。而且名副其实。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="6域"><strong>6、域</strong><a href="#6域" class="hash-link" aria-label="6域的直接链接" title="6域的直接链接">​</a></h2>
<p>使用直观的例子能更好地解释域：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># According to the following line</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># $1 $2 $3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 00:34:23 GET /foo/bar.html</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># _____________ _____________/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># $0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Hack attempt?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/admin.html$/ &amp;&amp; $2 == &quot;DELETE&quot; {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print &quot;Hacker Alert!&quot;;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>域（默认地）由空格分隔。$0 域代表了一整行的字符串。 $1 域是第一块字符串（在任何空格之前）， $2 域是后一块，以此类推。</p>
<p>一个有趣的事实（并且是在大多是情况下我们要避免的事情），你可以通过给相应的域赋值来修改相应的行。例如，如果你在一个块里执行 <code>$0 = “HAHA THE LINE IS GONE”</code>，那么现在下一个模式将会对修改后的行进行操作而不是操作原始的行。其他的域变量都类似。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="7行为"><strong>7、行为</strong><a href="#7行为" class="hash-link" aria-label="7行为的直接链接" title="7行为的直接链接">​</a></h2>
<p>这里有一堆可用的行为（possible actions），但是最常用和最有用的行为（以我的经验来说）是：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{ print $0; } # prints $0. In this case, equivalent to &#x27;print&#x27; alone</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ exit; } # ends the program</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ next; } # skips to the next line of input</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ a=$1; b=$0 } # variable assignment</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ c[$1] = $2 } # variable assignment (array)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ if (BOOLEAN) { ACTION }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else if (BOOLEAN) { ACTION }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">else { ACTION }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ for (i=1; i&lt;x; i++) { ACTION } }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ for (item in c) { ACTION } }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这些内容将会成为你的 Awk 工具箱的主要工具，在你处理日志之类的文件时你可以随意地使用它们。</p>
<p>Awk 里的变量都是全局变量。无论你在给定的块里定义什么变量，它对其他的块都是可见的，甚至是对每一行都是可见的。这严重限制了你的Awk脚本大小，不然他们会造成不可维护的可怕结果。请编写尽可能小的脚本。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="8函数"><strong>8、函数</strong><a href="#8函数" class="hash-link" aria-label="8函数的直接链接" title="8函数的直接链接">​</a></h2>
<p>可以使用下面的语法来调用函数：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">{ somecall($2) }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这里有一些有限的内置函数可以使用，所以我可以给出这些函数的<a href="https://www.gnu.org/software/gawk/manual/html_node/Built_002din.html#Built_002din" target="_blank" rel="noopener noreferrer">通用文档（regular documentation）</a><a href="https://www.gnu.org/software/gawk/manual/html_node/Built_002din.html#Built_002din" target="_blank" rel="noopener noreferrer">5</a>。</p>
<p>用户定义的函数同样很简单：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># function arguments are call-by-value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function name(parameter-list) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ACTIONS; # same actions as usual</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># return is a valid keyword</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">function add1(val) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">return val+1;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="9特殊变量"><strong>9、特殊变量</strong><a href="#9特殊变量" class="hash-link" aria-label="9特殊变量的直接链接" title="9特殊变量的直接链接">​</a></h2>
<p>除了常规变量（全局的，可以在任意地方使用），这里还有一系列特殊的变量，它们的的作用有点像配置条目（configuration entries）：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BEGIN { # Can be modified by the user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">FS = &quot;,&quot;; # Field Separator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RS = &quot;n&quot;; # Record Separator (lines)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OFS = &quot; &quot;; # Output Field Separator</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ORS = &quot;n&quot;; # Output Record Separator (lines)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">{ # Can&#x27;t be modified by the user</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NF # Number of Fields in the current Record (line)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NR # Number of Records seen so far</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ARGV / ARGC # Script Arguments</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>我把可修改的变量放在 BEGIN 里，因为我更喜欢在那重写它们。但是这些变量的重写可以放在脚本的任意地方然后在后面的行里生效。</p>
<h2 class="anchor anchorWithHideOnScrollNavbar_WYt5" id="10示例"><strong>10、示例</strong><a href="#10示例" class="hash-link" aria-label="10示例的直接链接" title="10示例的直接链接">​</a></h2>
<p>以上的就是 Awk 语言的核心内容。我这里没有大量的例子，因为我趋向于使用 Awk 来完成快速的一次性任务。</p>
<p>不过我依然有一些随身携带的脚本文件，用来处理一些事情和测试。我最喜欢的一个脚本是用来处理 Erlang 的崩溃转储文件，形如下面的：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">=erl_crash_dump:0.3</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tue Nov 18 02:52:44 2014</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slogan: init terminating in do_boot ()</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">System version: Erlang/OTP 17 [erts-6.2] [source] [64-bit] [smp:8:8] [async-threads:10] [hipe] [kernel-poll:false]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Compiled: Fri Sep 19 03:23:19 2014</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Taints:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Atoms: 12167</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=memory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total: 19012936</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">processes: 4327912</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">processes_used: 4319928</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">system: 14685024</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">atom: 339441</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">atom_used: 331087</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">binary: 1367680</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">code: 8384804</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ets: 382552</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=hash_table:atom_tab</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">size: 9643</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">used: 6949</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=allocator:instr</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">option m: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">option s: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">option t: false</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=proc:&lt;0.0.0&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">State: Running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Name: init</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Spawned as: otp_ring0:start/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Run queue: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Spawned by: []</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Started: Tue Nov 18 02:52:35 2014</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Message queue length: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Number of heap fragments: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Heap fragment data: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Link list: [&lt;0.3.0&gt;, &lt;0.7.0&gt;, &lt;0.6.0&gt;]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Reductions: 29265</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Stack+heap: 1598</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OldHeap: 610</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Heap unused: 656</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">OldHeap unused: 468</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Memory: 18584</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Program counter: 0x00007f42f9566200 (init:boot_loop/2 + 64)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">CP: 0x0000000000000000 (invalid)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=proc:&lt;0.3.0&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">State: Waiting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=port:#Port&lt;0.0&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slot: 0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connected: &lt;0.3.0&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Links: &lt;0.3.0&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Port controls linked-in driver: efile</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">=port:#Port&lt;0.14&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Slot: 112</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connected: &lt;0.3.0&gt;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>产生下面的结果：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">$ awk -f queue_fun.awk $PATH_TO_DUMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">MESSAGE QUEUE LENGTH: CURRENT FUNCTION</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">======================================</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">10641: io:wait_io_mon_reply/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">12646: io:wait_io_mon_reply/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">32991: io:wait_io_mon_reply/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">2183837: io:wait_io_mon_reply/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">730790: io:wait_io_mon_reply/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">80194: io:wait_io_mon_reply/2</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">...</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>这是在Erlang进程里运行的函数列表，它们导致了 mailboxe 变得很庞大。<a href="https://github.com/ferd/recon/blob/master/script/queue_fun.awk" target="_blank" rel="noopener noreferrer">脚本</a><a href="https://github.com/ferd/recon/blob/master/script/queue_fun.awk" target="_blank" rel="noopener noreferrer">6</a>在这：</p>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Parse Erlang Crash Dumps and correlate mailbox size to the currently running</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># function.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Once in the procs section of the dump, all processes are displayed with</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># =proc:&lt;0.M.N&gt; followed by a list of their attributes, which include the</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># message queue length and the program counter (what code is currently</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># executing).</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Run as:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># $ awk -v threshold=$THRESHOLD -f queue_fun.awk $CRASHDUMP</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">#</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Where $THRESHOLD is the smallest mailbox you want inspects. Default value</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># is 1000.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">BEGIN {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">if (threshold == &quot;&quot;) {</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">threshold = 1000 # default mailbox size</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">procs = 0 # are we in the =procs entries?</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print &quot;MESSAGE QUEUE LENGTH: CURRENT FUNCTION&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">print &quot;======================================&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Only bother with the =proc: entries. Anything else is useless.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">procs == 0 &amp;&amp; /^=proc/ { procs = 1 } # entering the =procs entries</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">procs == 1 &amp;&amp; /^=/ &amp;&amp; !/^=proc/ { exit 0 } # we&#x27;re done</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Message queue length: 1210</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1 2 3 4</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/^Message queue length: / &amp;&amp; $4 &gt;= threshold { flag=1; ct=$4 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/^Message queue length: / &amp;&amp; $4 &lt; threshold { flag=0 }</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"> </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Program counter: 0x00007f5fb8cb2238 (io:wait_io_mon_reply/2 + 56)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># 1 2 3 4 5 6</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">flag == 1 &amp;&amp; /^Program counter: / { print ct &quot;:&quot;, substr($4,2) }</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="复制代码到剪贴板" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg viewBox="0 0 24 24" class="copyButtonIcon_y97N"><path fill="currentColor" d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg viewBox="0 0 24 24" class="copyButtonSuccessIcon_LjdS"><path fill="currentColor" d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div>
<p>你跟上思路没？如果跟上了，你已经了解了 Awk。恭喜！</p>
<hr></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="文件选项卡"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/Linux/Sed 命令完全指南"><div class="pagination-nav__sublabel">上一页</div><div class="pagination-nav__label">Sed 命令完全指南</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/Linux/Socat 命令总结"><div class="pagination-nav__sublabel">下一页</div><div class="pagination-nav__label">Socat 命令总结</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#1什么是-awk" class="table-of-contents__link toc-highlight"><strong>1、什么是 Awk</strong></a></li><li><a href="#2代码结构" class="table-of-contents__link toc-highlight"><strong>2、代码结构</strong></a></li><li><a href="#3数据类型" class="table-of-contents__link toc-highlight"><strong>3、数据类型</strong></a></li><li><a href="#4模式" class="table-of-contents__link toc-highlight"><strong>4、模式</strong></a></li><li><a href="#5特殊的模式" class="table-of-contents__link toc-highlight"><strong>5、特殊的模式</strong></a></li><li><a href="#6域" class="table-of-contents__link toc-highlight"><strong>6、域</strong></a></li><li><a href="#7行为" class="table-of-contents__link toc-highlight"><strong>7、行为</strong></a></li><li><a href="#8函数" class="table-of-contents__link toc-highlight"><strong>8、函数</strong></a></li><li><a href="#9特殊变量" class="table-of-contents__link toc-highlight"><strong>9、特殊变量</strong></a></li><li><a href="#10示例" class="table-of-contents__link toc-highlight"><strong>10、示例</strong></a></li></ul></div></div></div></div></main></div></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="margin-bottom--sm"><a href="https://www.cnblogs.com/kqdssheng" rel="noopener noreferrer" class="footerLogoLink_BH7S"><img src="/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="30" height="30"><img src="/img/logo.svg" alt="博客园" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="30" height="30"></a></div></div></div></footer></div>
</body>
</html>